# システム構成

このドキュメントでは、MVPのシステム構成について説明します。

## 全体アーキテクチャ

MVPでは、シンプルな3層アーキテクチャを採用します：

1. **フロントエンド層**: Next.jsによるWebアプリケーション
2. **バックエンド層**: FastAPIによるRESTful API
3. **データ層**: PostgreSQLデータベース

## システム構成図

```
+-----------------------+     +--------------------+     +-------------------+
|    フロントエンド      |     |     バックエンド     |     |    データベース    |
|    (Next.js)         |---->|    (FastAPI)      |---->|   (PostgreSQL)    |
+-----------------------+     +--------------------+     +-------------------+
         |                           |                           |
         v                           v                           v
+------------------------+  +---------------------+  +------------------------+
| - UI/UXコンポーネント    |  | - REST API         |  | - ユーザー情報         |
| - 状態管理（Context）    |  | - ビジネスロジック   |  | - 問題データ           |
| - 数式レンダリング        |  | - データ検証        |  | - 解答履歴            |
| - API通信               |  | - 認証・認可処理     |  | - 学習進捗データ       |
+------------------------+  +---------------------+  +------------------------+
```

## コンポーネント詳細

### フロントエンドコンポーネント

- **UI層**: React.jsコンポーネント
  - 共通コンポーネント
  - 画面ごとのコンポーネント
  - 数式表示コンポーネント（MathJax/KaTeX）

- **状態管理**: React Context API
  - ユーザー認証状態
  - フォーム状態
  - UI状態

- **通信層**: Axios
  - REST APIとの通信
  - 認証トークン管理

### バックエンドコンポーネント

- **API層**: FastAPI
  - エンドポイント定義
  - リクエスト検証
  - レスポンス生成

- **ビジネスロジック層**:
  - ユーザー管理
  - コンテンツ管理
  - 学習管理
  - 採点処理

- **データアクセス層**:
  - SQLAlchemy ORM
  - モデル定義
  - クエリビルダー

### データベースコンポーネント

- **リレーショナルデータベース**: PostgreSQL
  - ユーザーテーブル
  - コンテンツテーブル
  - 学習データテーブル

## 通信フロー

1. **ユーザー操作**:
   - ユーザーがブラウザでUIを操作

2. **フロントエンド処理**:
   - UIイベント処理
   - 状態更新
   - API呼び出し

3. **API通信**:
   - フロントエンドからバックエンドへリクエスト（REST）
   - 認証トークンの送信

4. **バックエンド処理**:
   - リクエスト受信・検証
   - ビジネスロジック実行
   - データベース操作

5. **データベース操作**:
   - CRUD操作の実行
   - トランザクション管理

6. **レスポンス返却**:
   - バックエンドからフロントエンドへのレスポンス（JSON）

7. **UI更新**:
   - 受信データに基づくUI更新

## デプロイ構成

MVPでは、シンプルなクラウドサービスを利用したデプロイを行います：

- **フロントエンド**: Vercel（Next.js最適化）
- **バックエンド**: Herokuまたは同等のPythonアプリケーションホスティング
- **データベース**: 管理されたPostgreSQLサービス（Heroku Postgres等）

## セキュリティ構成

MVPでは、基本的なセキュリティ対策を実装します：

- **認証**: JWTトークンベースの認証
- **通信暗号化**: HTTPS（SSL/TLS）
- **データ保護**: パスワードハッシュ化（bcrypt）
- **入力検証**: リクエストバリデーション
- **CORS**: 適切なCORSポリシー設定

## スケーラビリティの考慮

MVPでは、将来的なスケーリングを考慮した以下の設計ポイントを採用します：

- フロントエンド・バックエンドの明確な分離
- RESTful API設計による拡張性
- 状態管理の集中化
- データベースのインデックス最適化

ただし、MVPの段階では複雑なスケーリング対策は実装せず、将来の拡張に備えた基盤設計を重視します。
